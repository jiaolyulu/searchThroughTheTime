(()=>{var zn=Object.create;var ke=Object.defineProperty,Wn=Object.defineProperties,Ln=Object.getOwnPropertyDescriptor,Un=Object.getOwnPropertyDescriptors,Kn=Object.getOwnPropertyNames,Be=Object.getOwnPropertySymbols,Hn=Object.getPrototypeOf,It=Object.prototype.hasOwnProperty,vr=Object.prototype.propertyIsEnumerable;var Tt=(t,e,r)=>e in t?ke(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,g=(t,e)=>{for(var r in e||(e={}))It.call(e,r)&&Tt(t,r,e[r]);if(Be)for(var r of Be(e))vr.call(e,r)&&Tt(t,r,e[r]);return t},x=(t,e)=>Wn(t,Un(e)),br=t=>ke(t,"__esModule",{value:!0});var jr=(t,e)=>{var r={};for(var o in t)It.call(t,o)&&e.indexOf(o)<0&&(r[o]=t[o]);if(t!=null&&Be)for(var o of Be(t))e.indexOf(o)<0&&vr.call(t,o)&&(r[o]=t[o]);return r};var Fe=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports),wt=(t,e)=>{br(t);for(var r in e)ke(t,r,{get:e[r],enumerable:!0})},Gn=(t,e,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of Kn(e))!It.call(t,o)&&o!=="default"&&ke(t,o,{get:()=>e[o],enumerable:!(r=Ln(e,o))||r.enumerable});return t},Re=t=>Gn(br(ke(t!=null?zn(Hn(t)):{},"default",t&&t.__esModule&&"default"in t?{get:()=>t.default,enumerable:!0}:{value:t,enumerable:!0})),t);var l=(t,e,r)=>(Tt(t,typeof e!="symbol"?e+"":e,r),r);var No=Fe((Mc,Vo)=>{var Zi;Vo.exports=Zi=function(){function t(e,r,o,n){this.set(e,r,o,n)}return t.prototype.set=function(e,r,o,n){this._cx=3*e,this._bx=3*(o-e)-this._cx,this._ax=1-this._cx-this._bx,this._cy=3*r,this._by=3*(n-r)-this._cy,this._ay=1-this._cy-this._by},t.epsilon=1e-6,t.prototype._sampleCurveX=function(e){return((this._ax*e+this._bx)*e+this._cx)*e},t.prototype._sampleCurveY=function(e){return((this._ay*e+this._by)*e+this._cy)*e},t.prototype._sampleCurveDerivativeX=function(e){return(3*this._ax*e+2*this._bx)*e+this._cx},t.prototype._solveCurveX=function(e,r){var o,n,a,i,s,u;for(a=void 0,i=void 0,s=void 0,u=void 0,o=void 0,n=void 0,s=e,n=0;n<8;){if(u=this._sampleCurveX(s)-e,Math.abs(u)<r)return s;if(o=this._sampleCurveDerivativeX(s),Math.abs(o)<r)break;s=s-u/o,n++}if(a=0,i=1,s=e,s<a)return a;if(s>i)return i;for(;a<i;){if(u=this._sampleCurveX(s),Math.abs(u-e)<r)return s;e>u?a=s:i=s,s=(i-a)*.5+a}return s},t.prototype.solve=function(e,r){return this._sampleCurveY(this._solveCurveX(e,r))},t.prototype.solveSimple=function(e){return this._sampleCurveY(this._solveCurveX(e,1e-6))},t}()});var qo=Fe((dd,Ro)=>{var nt,Lt;nt=[];Lt=[];function ts(t,e,r){var o,n,a,i,s,u,p,f;if(t===e)return 0;if(o=t.length,n=e.length,o===0)return n;if(n===0)return o;for(r&&(t=t.toLowerCase(),e=e.toLowerCase()),p=0;p<o;)Lt[p]=t.charCodeAt(p),nt[p]=++p;for(f=0;f<n;)for(a=e.charCodeAt(f),i=s=f++,p=-1;++p<o;)u=a===Lt[p]?s:s+1,s=nt[p],nt[p]=i=s>i?u>i?i+1:u:u>s?s+1:u;return i}Ro.exports=ts});var Lo=Fe((hd,Wo)=>{var zo=qo();function rs(){var t,e,r,o,n,a=0,i=arguments[0],s=arguments[1],u=s.length,p=arguments[2];p&&(o=p.threshold,n=p.ignoreCase),o===void 0&&(o=0);for(var f=0;f<u;++f)n?e=zo(i,s[f],!0):e=zo(i,s[f]),e>i.length?t=1-e/s[f].length:t=1-e/i.length,t>a&&(a=t,r=s[f]);return a>=o?r:null}Wo.exports=rs});var Qt=Fe((Qh,In)=>{"use strict";In.exports=function t(e,r){if(e===r)return!0;if(e&&r&&typeof e=="object"&&typeof r=="object"){if(e.constructor!==r.constructor)return!1;var o,n,a;if(Array.isArray(e)){if(o=e.length,o!=r.length)return!1;for(n=o;n--!=0;)if(!t(e[n],r[n]))return!1;return!0}if(e.constructor===RegExp)return e.source===r.source&&e.flags===r.flags;if(e.valueOf!==Object.prototype.valueOf)return e.valueOf()===r.valueOf();if(e.toString!==Object.prototype.toString)return e.toString()===r.toString();if(a=Object.keys(e),o=a.length,o!==Object.keys(r).length)return!1;for(n=o;n--!=0;)if(!Object.prototype.hasOwnProperty.call(r,a[n]))return!1;for(n=o;n--!=0;){var i=a[n];if(!t(e[i],r[i]))return!1}return!0}return e!==e&&r!==r}});var gr={};wt(gr,{getProject:()=>Bn,onChange:()=>Fn,types:()=>ft});var yr={};wt(yr,{getProject:()=>Bn,onChange:()=>Fn,types:()=>ft});var Jn=Array.isArray,ue=Jn;var Yn=typeof window=="object"&&window&&window.Object===Object&&window,xr=Yn;var Xn=typeof self=="object"&&self&&self.Object===Object&&self,Zn=xr||Xn||Function("return this")(),le=Zn;var Qn=le.Symbol,N=Qn;var Pr=Object.prototype,ea=Pr.hasOwnProperty,ta=Pr.toString,Ce=N?N.toStringTag:void 0;function ra(t){var e=ea.call(t,Ce),r=t[Ce];try{t[Ce]=void 0;var o=!0}catch(a){}var n=ta.call(t);return o&&(e?t[Ce]=r:delete t[Ce]),n}var _r=ra;var oa=Object.prototype,na=oa.toString;function aa(t){return na.call(t)}var Sr=aa;var ia="[object Null]",sa="[object Undefined]",Ir=N?N.toStringTag:void 0;function pa(t){return t==null?t===void 0?sa:ia:Ir&&Ir in Object(t)?_r(t):Sr(t)}var fe=pa;function ua(t){return t!=null&&typeof t=="object"}var qe=ua;var la="[object Symbol]";function fa(t){return typeof t=="symbol"||qe(t)&&fe(t)==la}var z=fa;var ca=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,da=/^\w*$/;function ha(t,e){if(ue(t))return!1;var r=typeof t;return r=="number"||r=="symbol"||r=="boolean"||t==null||z(t)?!0:da.test(t)||!ca.test(t)||e!=null&&t in Object(e)}var Tr=ha;function ma(t){var e=typeof t;return t!=null&&(e=="object"||e=="function")}var Y=ma;var ya="[object AsyncFunction]",ga="[object Function]",va="[object GeneratorFunction]",ba="[object Proxy]";function ja(t){if(!Y(t))return!1;var e=fe(t);return e==ga||e==va||e==ya||e==ba}var wr=ja;var xa=le["__core-js_shared__"],ze=xa;var Dr=function(){var t=/[^.]+$/.exec(ze&&ze.keys&&ze.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function Pa(t){return!!Dr&&Dr in t}var Ar=Pa;var _a=Function.prototype,Sa=_a.toString;function Ia(t){if(t!=null){try{return Sa.call(t)}catch(e){}try{return t+""}catch(e){}}return""}var Or=Ia;var Ta=/[\\^$.*+?()[\]{}|]/g,wa=/^\[object .+?Constructor\]$/,Da=Function.prototype,Aa=Object.prototype,Oa=Da.toString,ka=Aa.hasOwnProperty,Ca=RegExp("^"+Oa.call(ka).replace(Ta,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function Va(t){if(!Y(t)||Ar(t))return!1;var e=wr(t)?Ca:wa;return e.test(Or(t))}var kr=Va;function Na(t,e){return t==null?void 0:t[e]}var Cr=Na;function Ma(t,e){var r=Cr(t,e);return kr(r)?r:void 0}var We=Ma;var Ea=We(Object,"create"),M=Ea;function $a(){this.__data__=M?M(null):{},this.size=0}var Vr=$a;function Ba(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}var Nr=Ba;var Fa="__lodash_hash_undefined__",Ra=Object.prototype,qa=Ra.hasOwnProperty;function za(t){var e=this.__data__;if(M){var r=e[t];return r===Fa?void 0:r}return qa.call(e,t)?e[t]:void 0}var Mr=za;var Wa=Object.prototype,La=Wa.hasOwnProperty;function Ua(t){var e=this.__data__;return M?e[t]!==void 0:La.call(e,t)}var Er=Ua;var Ka="__lodash_hash_undefined__";function Ha(t,e){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=M&&e===void 0?Ka:e,this}var $r=Ha;function ce(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}ce.prototype.clear=Vr;ce.prototype.delete=Nr;ce.prototype.get=Mr;ce.prototype.has=Er;ce.prototype.set=$r;var Dt=ce;function Ga(){this.__data__=[],this.size=0}var Br=Ga;function Ja(t,e){return t===e||t!==t&&e!==e}var Fr=Ja;function Ya(t,e){for(var r=t.length;r--;)if(Fr(t[r][0],e))return r;return-1}var W=Ya;var Xa=Array.prototype,Za=Xa.splice;function Qa(t){var e=this.__data__,r=W(e,t);if(r<0)return!1;var o=e.length-1;return r==o?e.pop():Za.call(e,r,1),--this.size,!0}var Rr=Qa;function ei(t){var e=this.__data__,r=W(e,t);return r<0?void 0:e[r][1]}var qr=ei;function ti(t){return W(this.__data__,t)>-1}var zr=ti;function ri(t,e){var r=this.__data__,o=W(r,t);return o<0?(++this.size,r.push([t,e])):r[o][1]=e,this}var Wr=ri;function de(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}de.prototype.clear=Br;de.prototype.delete=Rr;de.prototype.get=qr;de.prototype.has=zr;de.prototype.set=Wr;var Lr=de;var oi=We(le,"Map"),Ur=oi;function ni(){this.size=0,this.__data__={hash:new Dt,map:new(Ur||Lr),string:new Dt}}var Kr=ni;function ai(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}var Hr=ai;function ii(t,e){var r=t.__data__;return Hr(e)?r[typeof e=="string"?"string":"hash"]:r.map}var L=ii;function si(t){var e=L(this,t).delete(t);return this.size-=e?1:0,e}var Gr=si;function pi(t){return L(this,t).get(t)}var Jr=pi;function ui(t){return L(this,t).has(t)}var Yr=ui;function li(t,e){var r=L(this,t),o=r.size;return r.set(t,e),this.size+=r.size==o?0:1,this}var Xr=li;function he(t){var e=-1,r=t==null?0:t.length;for(this.clear();++e<r;){var o=t[e];this.set(o[0],o[1])}}he.prototype.clear=Kr;he.prototype.delete=Gr;he.prototype.get=Jr;he.prototype.has=Yr;he.prototype.set=Xr;var At=he;var fi="Expected a function";function Ot(t,e){if(typeof t!="function"||e!=null&&typeof e!="function")throw new TypeError(fi);var r=function(){var o=arguments,n=e?e.apply(this,o):o[0],a=r.cache;if(a.has(n))return a.get(n);var i=t.apply(this,o);return r.cache=a.set(n,i)||a,i};return r.cache=new(Ot.Cache||At),r}Ot.Cache=At;var Zr=Ot;var ci=500;function di(t){var e=Zr(t,function(o){return r.size===ci&&r.clear(),o}),r=e.cache;return e}var Qr=di;var hi=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,mi=/\\(\\)?/g,yi=Qr(function(t){var e=[];return t.charCodeAt(0)===46&&e.push(""),t.replace(hi,function(r,o,n,a){e.push(n?a.replace(mi,"$1"):o||r)}),e}),eo=yi;function gi(t,e){for(var r=-1,o=t==null?0:t.length,n=Array(o);++r<o;)n[r]=e(t[r],r,t);return n}var to=gi;var vi=1/0,ro=N?N.prototype:void 0,oo=ro?ro.toString:void 0;function no(t){if(typeof t=="string")return t;if(ue(t))return to(t,no)+"";if(z(t))return oo?oo.call(t):"";var e=t+"";return e=="0"&&1/t==-vi?"-0":e}var Le=no;function bi(t){return t==null?"":Le(t)}var Ue=bi;function ji(t,e){return ue(t)?t:Tr(t,e)?[t]:eo(Ue(t))}var ao=ji;var xi=1/0;function Pi(t){if(typeof t=="string"||z(t))return t;var e=t+"";return e=="0"&&1/t==-xi?"-0":e}var io=Pi;function _i(t,e){e=ao(e,t);for(var r=0,o=e.length;t!=null&&r<o;)t=t[io(e[r++])];return r&&r==o?t:void 0}var so=_i;function Si(t,e,r){var o=t==null?void 0:so(t,e);return o===void 0?r:o}var me=Si;function Ii(t,e){return function(r){return t(e(r))}}var po=Ii;var Ti=po(Object.getPrototypeOf,Object),uo=Ti;var wi="[object Object]",Di=Function.prototype,Ai=Object.prototype,lo=Di.toString,Oi=Ai.hasOwnProperty,ki=lo.call(Object);function Ci(t){if(!qe(t)||fe(t)!=wi)return!1;var e=uo(t);if(e===null)return!0;var r=Oi.call(e,"constructor")&&e.constructor;return typeof r=="function"&&r instanceof r&&lo.call(r)==ki}var Ve=Ci;function Vi(t){var e=t==null?0:t.length;return e?t[e-1]:void 0}var fo=Vi;var Ke=class{constructor(e){this._untapFromSourceTimeout=null;this._cb=e=>{this._tappers.forEach(r=>{r(e)})};this._lastTapperId=0,this._untapFromSource=null,this._props=e,this._tappers=new Map}_check(){this._untapFromSource?this._tappers.size===0&&this._scheduleToUntapFromSource():this._tappers.size!==0&&(this._untapFromSource=this._props.tapToSource(this._cb))}_scheduleToUntapFromSource(){this._untapFromSourceTimeout===null&&(this._untapFromSourceTimeout=setTimeout(()=>{this._untapFromSourceTimeout=null,this._tappers.size===0&&(this._untapFromSource(),this._untapFromSource=null)},0))}tap(e){let r=this._lastTapperId++;return this._tappers.set(r,e),this._check(),()=>{this._removeTapperById(r)}}_removeTapperById(e){this._tappers.delete(e),this._check()}};var U=class{constructor(){this._lastTapperId=0,this._tappers=new Map,this.tappable=new Ke({tapToSource:e=>this._tap(e)})}_tap(e){let r=this._lastTapperId++;return this._tappers.set(r,e),this._onNumberOfTappersChangeListener&&this._onNumberOfTappersChangeListener(this._tappers.size),()=>{this._removeTapperById(r)}}_removeTapperById(e){let r=this._tappers.size;this._tappers.delete(e);let o=this._tappers.size;r!==o&&this._onNumberOfTappersChangeListener&&this._onNumberOfTappersChangeListener(this._tappers.size)}emit(e){this._tappers.forEach(r=>{r(e)})}hasTappers(){return this._tappers.size!==0}onNumberOfTappersChange(e){this._onNumberOfTappersChangeListener=e}};var He=class{constructor(e,r){this._possiblyMarkAsStale=()=>{this._ticker.onThisOrNextTick(this._refresh)};this._refresh=()=>{let e=this._derivation.getValue();e===this._lastValue&&this._lastValueRecorded===!0||(this._lastValue=e,this._lastValueRecorded=!0,this._emitter.emit(e))};return this._derivation=e,this._ticker=r,this._emitter=new U,this._emitter.onNumberOfTappersChange(()=>{this._reactToNumberOfTappersChange()}),this._hadTappers=!1,this._lastValueRecorded=!1,this._lastValue=void 0,this}_reactToNumberOfTappersChange(){let e=this._emitter.hasTappers();e!==this._hadTappers&&(this._hadTappers=e,e?this._derivation.addDependent(this._possiblyMarkAsStale):this._derivation.removeDependent(this._possiblyMarkAsStale))}tappable(){return this._emitter.tappable}};var Ge=class{constructor(e,r=!1){this.dontEmitValues=r;this._possiblyMarkAsStale=()=>{this._emitter.emit(void 0)};return this._derivation=e,this._emitter=new U,this._emitter.onNumberOfTappersChange(()=>{this._reactToNumberOfTappersChange()}),this._hadTappers=!1,this}_reactToNumberOfTappersChange(){let e=this._emitter.hasTappers();e!==this._hadTappers&&(this._hadTappers=e,e?this._derivation.addDependent(this._possiblyMarkAsStale):this._derivation.removeDependent(this._possiblyMarkAsStale))}tappable(){return this._emitter.tappable}};function C(t){return t&&t.isDerivation&&t.isDerivation===!0}var j;(function(o){o[o.none=0]="none",o[o.dep=1]="dep",o[o.inner=2]="inner"})(j||(j={}));var Ni=()=>{class t extends _{constructor(r,o){super();this._depDerivation=r;this._fn=o;return this._innerDerivation=void 0,this._staleDependency=1,this._addDependency(r),this}_recalculateHot(){let r=this._staleDependency;if(this._staleDependency=0,r===2)return this._innerDerivation.getValue();let o=this._fn(this._depDerivation.getValue());return C(o)?(this._innerDerivation=o,this._addDependency(o),o.getValue()):o}_recalculateCold(){let r=this._fn(this._depDerivation.getValue());return C(r)?r.getValue():r}_recalculate(){return this.isHot?this._recalculateHot():this._recalculateCold()}_reactToDependencyBecomingStale(r){let o=r===this._depDerivation?1:2;if(o===2&&r!==this._innerDerivation)throw Error("got a _reactToDependencyBecomingStale() from neither the dep nor the inner derivation");this._staleDependency===0?(this._staleDependency=o,o===1&&this._removeInnerDerivation()):this._staleDependency===1||o===1&&(this._staleDependency=1,this._removeInnerDerivation())}_removeInnerDerivation(){this._innerDerivation&&(this._removeDependency(this._innerDerivation),this._innerDerivation=void 0)}_keepHot(){this._staleDependency=1,this.getValue()}_becomeCold(){this._staleDependency=1,this._removeInnerDerivation()}}return t.displayName="flatMap",t},kt;function Ct(t,e){return kt||(kt=Ni()),new kt(t,e)}var Mi=()=>class extends _{constructor(e,r){super();this._dep=e;this._fn=r;this._addDependency(e)}_recalculate(){return this._fn(this._dep.getValue())}_reactToDependencyBecomingStale(){}},Vt;function Nt(t,e){return Vt||(Vt=Mi()),new Vt(t,e)}var ye=class{constructor(){this._head=void 0}peek(){return this._head&&this._head.data}pop(){let e=this._head;if(!!e)return this._head=e.next,e.data}push(e){let r={next:this._head,data:e};this._head=r}};function co(){let t=()=>{},e=new ye,r=t;return{type:"Dataverse_discoveryMechanism",startIgnoringDependencies:()=>{e.push(r)},stopIgnoringDependencies:()=>{e.peek()!==r||e.pop()},reportResolutionStart:p=>{let f=e.peek();f&&f(p),e.push(r)},reportResolutionEnd:p=>{e.pop()},pushCollector:p=>{e.push(p)},popCollector:p=>{if(e.peek()!==p)throw new Error("Popped collector is not on top of the stack");e.pop()}}}function Ei(){let t="__dataverse_discoveryMechanism_sharedStack";if(window){let e=window[t];if(e&&typeof e=="object"&&e.type==="Dataverse_discoveryMechanism")return e;{let r=co();return window[t]=r,r}}else return co()}var{startIgnoringDependencies:ge,stopIgnoringDependencies:ve,reportResolutionEnd:ho,reportResolutionStart:mo,pushCollector:yo,popCollector:go}=Ei();var _=class{constructor(){this.isDerivation=!0;this._didMarkDependentsAsStale=!1;this._isHot=!1;this._isFresh=!1;this._lastValue=void 0;this._dependents=new Set;this._dependencies=new Set;this._internal_markAsStale=e=>{this._reactToDependencyBecomingStale(e),!this._didMarkDependentsAsStale&&(this._didMarkDependentsAsStale=!0,this._isFresh=!1,this._dependents.forEach(r=>{r(this)}))}}get isHot(){return this._isHot}_addDependency(e){this._dependencies.has(e)||(this._dependencies.add(e),this._isHot&&e.addDependent(this._internal_markAsStale))}_removeDependency(e){!this._dependencies.has(e)||(this._dependencies.delete(e),this._isHot&&e.removeDependent(this._internal_markAsStale))}changes(e){return new He(this,e).tappable()}changesWithoutValues(){return new Ge(this).tappable()}keepHot(){return this.changesWithoutValues().tap(()=>{})}tapImmediate(e,r){let o=this.changes(e).tap(r);return r(this.getValue()),o}addDependent(e){let r=this._dependents.size>0;this._dependents.add(e);let o=this._dependents.size>0;r!==o&&this._reactToNumberOfDependentsChange()}removeDependent(e){let r=this._dependents.size>0;this._dependents.delete(e);let o=this._dependents.size>0;r!==o&&this._reactToNumberOfDependentsChange()}_markAsStale(e){this._internal_markAsStale(e)}getValue(){if(mo(this),!this._isFresh){let e=this._recalculate();this._lastValue=e,this._isHot&&(this._isFresh=!0,this._didMarkDependentsAsStale=!1)}return ho(this),this._lastValue}_reactToNumberOfDependentsChange(){let e=this._dependents.size>0;e!==this._isHot&&(this._isHot=e,this._didMarkDependentsAsStale=!1,this._isFresh=!1,e?(this._dependencies.forEach(r=>{r.addDependent(this._internal_markAsStale)}),this._keepHot()):(this._dependencies.forEach(r=>{r.removeDependent(this._internal_markAsStale)}),this._becomeCold()))}_keepHot(){}_becomeCold(){}map(e){return Nt(this,e)}flatMap(e){return Ct(this,e)}};var vo=()=>{},X=class extends _{constructor(e,r){super();this._tapToSource=e;this._getValueFromSource=r;this._untapFromChanges=vo,this._cachedValue=void 0,this._hasCachedValue=!1}_recalculate(){return this.isHot?(this._hasCachedValue||(this._cachedValue=this._getValueFromSource(),this._hasCachedValue=!0),this._cachedValue):this._getValueFromSource()}_keepHot(){this._hasCachedValue=!1,this._cachedValue=void 0,this._untapFromChanges=this._tapToSource(e=>{this._hasCachedValue=!0,this._cachedValue=e,this._markAsStale(this)})}_becomeCold(){this._untapFromChanges(),this._untapFromChanges=vo,this._hasCachedValue=!1,this._cachedValue=void 0}_reactToDependencyBecomingStale(){}};var Mt=new WeakMap,bo=Symbol("pointerMeta"),jo=new WeakMap,$i={get(t,e){if(e===bo)return Mt.get(t);let r=jo.get(t);if(r||(r={},jo.set(t,r)),r[e])return r[e];let o=Mt.get(t),n=xo({root:o.root,path:[...o.path,e]});return r[e]=n,n}},Je=t=>t[bo],Ne=t=>{let{root:e,path:r}=Je(t);return{root:e,path:r}};function xo(t){var o;let e={root:t.root,path:(o=t.path)!=null?o:[]},r={};return Mt.set(r,e),new Proxy(r,$i)}var Z=xo,Q=t=>t&&!!Je(t);function Et(t,e,r){return e.length===0?r(t):Ye(t,e,r)}var Ye=(t,e,r)=>{if(e.length===0)return r(t);if(Array.isArray(t)){let[o,...n]=e;o=parseInt(String(o),10),isNaN(o)&&(o=0);let a=t[o],i=Ye(a,n,r);if(a===i)return t;let s=[...t];return s.splice(o,1,i),s}else if(typeof t=="object"&&t!==null){let[o,...n]=e,a=t[o],i=Ye(a,n,r);return a===i?t:x(g({},t),{[o]:i})}else{let[o,...n]=e;return{[o]:Ye(void 0,n,r)}}};var K;(function(o){o[o.Dict=0]="Dict",o[o.Array=1]="Array",o[o.Other=2]="Other"})(K||(K={}));var $t=t=>Array.isArray(t)?1:Ve(t)?0:2,Po=(t,e,r=$t(t))=>r===0&&typeof e=="string"||r===1&&Bi(e)?t[e]:void 0,Bi=t=>{let e=typeof t=="number"?t:parseInt(t,10);return!isNaN(e)&&e>=0&&e<1/0&&(e|0)===e},Xe=class{constructor(e,r){this._parent=e;this._path=r;this.children=new Map;this.identityChangeListeners=new Set}addIdentityChangeListener(e){this.identityChangeListeners.add(e)}removeIdentityChangeListener(e){this.identityChangeListeners.delete(e),this._checkForGC()}removeChild(e){this.children.delete(e),this._checkForGC()}getChild(e){return this.children.get(e)}getOrCreateChild(e){let r=this.children.get(e);return r||(r=r=new Xe(this,this._path.concat([e])),this.children.set(e,r)),r}_checkForGC(){this.identityChangeListeners.size>0||this.children.size>0||this._parent&&this._parent.removeChild(fo(this._path))}},y=class{constructor(e){this.$$isIdentityDerivationProvider=!0;this.reduceState=(e,r)=>{let o=Et(this.getState(),e,r);return this.setState(o),o};this._onPathValueChange=(e,r)=>{let o=this._getOrCreateScopeForPath(e);return o.identityChangeListeners.add(r),()=>{o.identityChangeListeners.delete(r)}};this._currentState=e,this._rootScope=new Xe(void 0,[]),this.pointer=Z({root:this,path:[]})}setState(e){let r=this._currentState;this._currentState=e,this._checkUpdates(this._rootScope,r,e)}getState(){return this._currentState}getIn(e){return e.length===0?this.getState():me(this.getState(),e)}setIn(e,r){return this.reduceState(e,()=>r)}_checkUpdates(e,r,o){if(r===o||(e.identityChangeListeners.forEach(i=>i(o)),e.children.size===0))return;let n=$t(r),a=$t(o);n===2&&n===a||e.children.forEach((i,s)=>{let u=Po(r,s,n),p=Po(o,s,a);this._checkUpdates(i,u,p)})}_getOrCreateScopeForPath(e){let r=this._rootScope;for(let o of e)r=r.getOrCreateChild(o);return r}getIdentityDerivation(e){return new X(r=>this._onPathValueChange(e,r),()=>this.getIn(e))}},_o=new WeakMap,S=t=>{let e=Je(t),r=_o.get(e);if(!r){let o=e.root;if(!Fi(o))throw new Error("Cannot run valueDerivation() on a pointer whose root is not an IdentityChangeProvider");let{path:n}=e;r=o.getIdentityDerivation(n),_o.set(e,r)}return r};function Fi(t){return typeof t=="object"&&t!==null&&t.$$isIdentityDerivationProvider===!0}var v=t=>Q(t)?S(t).getValue():C(t)?t.getValue():t;var E=class{constructor(e){this._value=e;this._emitter=new U;this._publicDerivation=new X(r=>this._emitter.tappable.tap(r),this.get.bind(this))}set(e){e!==this._value&&(this._value=e,this._emitter.emit(e))}get(){return this._value}get derivation(){return this._publicDerivation}};var T=class extends _{constructor(e){super();return this._v=e,this}_recalculate(){return this._v}_reactToDependencyBecomingStale(){}};var be=class{constructor(){this._ticking=!1;this._scheduledForThisOrNextTick=new Set,this._scheduledForNextTick=new Set,this._timeAtCurrentTick=0}onThisOrNextTick(e){this._scheduledForThisOrNextTick.add(e)}onNextTick(e){this._scheduledForNextTick.add(e)}offThisOrNextTick(e){this._scheduledForThisOrNextTick.delete(e)}offNextTick(e){this._scheduledForNextTick.delete(e)}get time(){return this._ticking?this._timeAtCurrentTick:performance.now()}tick(e=performance.now()){this._ticking=!0,this._timeAtCurrentTick=e,this._scheduledForNextTick.forEach(r=>this._scheduledForThisOrNextTick.add(r)),this._scheduledForNextTick.clear(),this._tick(0),this._ticking=!1}_tick(e){let r=this.time;if(e>10&&console.warn("_tick() recursing for 10 times"),e>100)throw new Error("Maximum recursion limit for _tick()");let o=this._scheduledForThisOrNextTick;if(this._scheduledForThisOrNextTick=new Set,o.forEach(n=>{n(r)}),this._scheduledForThisOrNextTick.size>0)return this._tick(e+1)}};var So=()=>{},Io=class extends _{constructor(e){super();this._fn=e;this._cacheOfDendencyValues=new Map;this._possiblyStaleDeps=new Set;this._prismScope=new je}_recalculate(){let e;if(this._possiblyStaleDeps.size>0){let n=!1;ge();for(let a of this._possiblyStaleDeps)if(this._cacheOfDendencyValues.get(a)!==a.getValue()){n=!0;break}if(ve(),this._possiblyStaleDeps.clear(),!n)return this._lastValue}let r=new Set;this._cacheOfDendencyValues.clear();let o=n=>{r.add(n),this._addDependency(n)};yo(o),V.push(this._prismScope);try{e=this._fn()}catch(n){console.error(n)}finally{V.pop()!==this._prismScope&&console.warn("The Prism hook stack has slipped. This is a bug.")}return go(o),this._dependencies.forEach(n=>{r.has(n)||this._removeDependency(n)}),this._dependencies=r,ge(),r.forEach(n=>{this._cacheOfDendencyValues.set(n,n.getValue())}),ve(),e}_reactToDependencyBecomingStale(e){this._possiblyStaleDeps.add(e)}_keepHot(){this._prismScope=new je,ge(),this.getValue(),ve()}_becomeCold(){To(this._prismScope),this._prismScope=new je}},je=class{constructor(){this.isPrismScope=!0;this._subs={}}sub(e){return this._subs[e]||(this._subs[e]=new je),this._subs[e]}get subs(){return this._subs}};function To(t){for(let[e,r]of Object.entries(t.subs))To(r);Ri(t)}function Ri(t){let e=Qe.get(t);if(e)for(let r of Object.keys(e)){let o=e[r];Ze(o.cleanup,void 0)}Qe.delete(t)}function Ze(t,e){let r=e,o=!1;try{r=t(),o=!0}catch(n){setTimeout(()=>{throw n})}return{success:o,returnValue:r}}var V=new ye,wo=new WeakMap,Qe=new WeakMap,Do=new WeakMap;function qi(t,e){let r=V.peek();if(!r)throw new Error("prism.ref() is called outside of a prism() call.");let o=wo.get(r);if(o||(o={},wo.set(r,o)),o[t])return o[t];{let n={current:e};return o[t]=n,n}}function zi(t,e,r){let o=V.peek();if(!o)throw new Error("prism.effect() is called outside of a prism() call.");let n=Qe.get(o);n||(n={},Qe.set(o,n)),n[t]||(n[t]={cleanup:So,deps:[{}]});let a=n[t];Ao(a.deps,r)&&(a.cleanup(),ge(),a.cleanup=Ze(e,So).returnValue,ve(),a.deps=r)}function Ao(t,e){return t===void 0||e===void 0||t.length!==e.length?!0:t.some((r,o)=>r!==e[o])}function Oo(t,e,r){let o=V.peek();if(!o)throw new Error("prism.memo() is called outside of a prism() call.");let n=Do.get(o);n||(n={},Do.set(o,n)),n[t]||(n[t]={cachedValue:null,deps:[{}]});let a=n[t];return Ao(a.deps,r)&&(ge(),a.cachedValue=Ze(e,void 0).returnValue,ve(),a.deps=r),a.cachedValue}function Wi(t,e){let{b:r,setValue:o}=O.memo("state/"+t,()=>{let n=new E(e);return{b:n,setValue:i=>n.set(i)}},[]);return[r.derivation.getValue(),o]}function Li(){if(!V.peek())throw new Error("The parent function is called outside of a prism() call.")}function Ui(t,e){let r=V.peek();if(!r)throw new Error("prism.scope() is called outside of a prism() call.");let o=r.sub(t);V.push(o);let n=Ze(e,void 0).returnValue;return V.pop(),n}function Ki(t,e,r){return Oo(t,()=>O(e),r).getValue()}function Hi(){return!!V.peek()}var O=t=>new Io(t);O.ref=qi;O.effect=zi;O.memo=Oo;O.ensurePrism=Li;O.state=Wi;O.scope=Ui;O.sub=Ki;O.inPrism=Hi;var d=O;var ee=class{constructor(e){this.$$isIdentityDerivationProvider=!0;this._currentPointerBox=new E(e),this.pointer=Z({root:this,path:[]})}setPointer(e){this._currentPointerBox.set(e)}getIdentityDerivation(e){return this._currentPointerBox.derivation.flatMap(r=>{let o=e.reduce((n,a)=>n[a],r);return S(o)})}};var ko=class{constructor(){l(this,"atom",new y({projects:{}}))}add(e,r){this.atom.reduceState(["projects",e],()=>r)}get(e){return this.atom.getState().projects[e]}has(e){return!!this.get(e)}},Gi=new ko,xe=Gi;var Co=new WeakMap;function m(t){return Co.get(t)}function H(t,e){Co.set(t,e)}var Bt=[];function Ft(t,e){return e.length===0?t:me(t,e)}var G=class{constructor(){l(this,"_values",{})}get(e,r){if(this.has(e))return this._values[e];{let o=r();return this._values[e]=o,o}}has(e){return this._values.hasOwnProperty(e)}};var Rt=new WeakMap;function qt(t){return zt(t)}function zt(t){if(Rt.has(t))return Rt.get(t);let e=t.type==="compound"?Yi(t):t.type==="enum"?Ji(t):t.default;return Rt.set(t,e),e}function Ji(t){let e={$case:t.defaultCase};for(let[r,o]of Object.entries(t.cases))e[r]=zt(o);return e}function Yi(t){let e={};for(let[r,o]of Object.entries(t.props))e[r]=zt(o);return e}var Xi={log:console.log,warn:console.warn,error:console.error,trace:console.trace},Pe=Xi;var Mo=Re(No());function Wt(t,e){return d(()=>{let r=v(t);return d.memo("driver",()=>r?r.type==="BasicKeyframedTrack"?Qi(r,e):(Pe.error("Track type not yet supported."),new T(void 0)):new T(void 0),[r]).getValue()})}function Qi(t,e){return d(()=>{let r=d.ref("state",{started:!1}),o=r.current,n=e.getValue();return(!o.started||n<o.validFrom||o.validTo<=n)&&(r.current=o=es(e,t)),o.der.getValue()})}var Eo=new T(void 0),es=(t,e)=>{let r=t.getValue();if(e.keyframes.length===0)return{started:!0,validFrom:-1/0,validTo:1/0,der:Eo};let o=0;for(;;){let n=e.keyframes[o];if(!n)return te.error;let a=o===e.keyframes.length-1;if(r<n.position)return o===0?te.beforeFirstKeyframe(n):te.error;if(n.position===r)return a?te.lastKeyframe(n):te.between(n,e.keyframes[o+1],t);if(o===e.keyframes.length-1)return te.lastKeyframe(n);{let i=o+1;if(e.keyframes[i].position<=r){o=i;continue}else return te.between(n,e.keyframes[o+1],t)}}},te={beforeFirstKeyframe(t){return{started:!0,validFrom:-1/0,validTo:t.position,der:new T(t.value)}},lastKeyframe(t){return{started:!0,validFrom:t.position,validTo:1/0,der:new T(t.value)}},between(t,e,r){if(!t.connectedRight)return{started:!0,validFrom:t.position,validTo:e.position,der:new T(t.value)};let o=new Mo.default(t.handles[2],t.handles[3],e.handles[0],e.handles[1]),n=i=>(i-t.position)/(e.position-t.position),a=d(()=>{let i=n(r.getValue()),s=o.solveSimple(i);return t.value+s*(e.value-t.value)});return{started:!0,validFrom:t.position,validTo:e.position,der:a}},error:{started:!0,validFrom:-1/0,validTo:1/0,der:Eo}};function _e(t,e,r){let n=r.get(t);if(n&&n.override===e)return n.merged;let a=g({},t);for(let i of Object.keys(e)){let s=e[i],u=t[i];a[i]=typeof s=="object"&&typeof u=="object"?_e(u,s,r):typeof s=="undefined"?u:s}return r.set(t,{override:e,merged:a}),a}function et(t,e){let r=t;for(let o of e)r=r[o];return r}var $o=(t,e)=>{let r=d.memo(t,()=>new y(e),[]);return r.setState(e),r};var Bo=new be,$=Bo,Fo=t=>{Bo.tick(t),window.requestAnimationFrame(Fo)};window.requestAnimationFrame(Fo);var tt=class{constructor(e){l(this,"_cache",new G);H(this,e)}get type(){return"Theatre_SheetObject_PublicAPI"}get props(){return m(this).propsP}get sheet(){return m(this).sheet.publicApi}get project(){return m(this).sheet.project.publicApi}get address(){return g({},m(this).address)}_valuesDerivation(){return this._cache.get("onValuesChangeDerivation",()=>{let e=m(this);return d(()=>v(e.getValues().getValue()))})}onValuesChange(e){return this._valuesDerivation().tapImmediate($,e)}get value(){return this._valuesDerivation().getValue()}set initialValue(e){m(this).setInitialValue(e)}};var rt=class{constructor(e,r,o){this.sheet=e;this.template=r;this.nativeObject=o;l(this,"$$isIdentityDerivationProvider",!0);l(this,"address");l(this,"publicApi");l(this,"_initialValue",new y({}));l(this,"_cache",new G);this.address=x(g({},r.address),{sheetInstanceId:e.address.sheetInstanceId}),this.publicApi=new tt(this)}get type(){return"Theatre_SheetObject"}getValues(){return this._cache.get("getValues()",()=>d(()=>{let e=v(this.template.getDefaultValues()),r=v(this._initialValue.pointer),o=d.memo("withInitialCache",()=>new WeakMap,[]),n=_e(e,r,o),a=v(this.template.getStaticValues()),i=d.memo("withStatics",()=>new WeakMap,[]),u=_e(n,a,i),p;{let h=d.memo("seq",()=>this.getSequencedValues(),[]),b=d.memo("withSeqsCache",()=>new WeakMap,[]);p=v(v(h)),u=_e(u,p,b)}return $o("finalAtom",u).pointer}))}getValueByPointer(e){let r=v(this.getValues()),{path:o}=Ne(e);return v(et(r,o))}getIdentityDerivation(e){return d(()=>{let r=v(this.getValues());return v(et(r,e))})}getSequencedValues(){return d(()=>{let e=d.memo("tracksToProcess",()=>this.template.getArrayOfValidSequenceTracks(),[]),r=v(e),o=new y({});return d.effect("processTracks",()=>{let n=[];for(let{trackId:a,pathToProp:i}of r){let s=this._trackIdToDerivation(a),u=()=>{o.setIn(i,s.getValue())},p=s.changesWithoutValues().tap(u);u(),n.push(p)}return()=>{for(let a of n)a()}},r),o.pointer})}_trackIdToDerivation(e){let r=this.template.project.pointers.historic.sheetsById[this.address.sheetId].sequence.tracksByObject[this.address.objectKey].trackData[e],o=this.sheet.getSequence().positionDerivation;return Wt(r,o)}get propsP(){return this._cache.get("propsP",()=>Z({root:this,path:[]}))}validateValue(e,r){}setInitialValue(e){this.validateValue(this.propsP,e),this._initialValue.setState(e)}};var ot=class{constructor(e,r,o,n){this.sheetTemplate=e;l(this,"address");l(this,"type","Theatre_SheetObjectTemplate");l(this,"_config");l(this,"_cache",new G);l(this,"project");this.address=x(g({},e.address),{objectKey:r}),this._config=new y(n),this.project=e.project}get config(){return this._config.getState()}createInstance(e,r,o){return this._config.setState(o),new rt(e,this,r)}overrideConfig(e){this._config.setState(e)}getDefaultValues(){return this._cache.get("getDefaultValues()",()=>d(()=>{let e=v(this._config.pointer);return qt(e)}))}getStaticValues(){return this._cache.get("getDerivationOfStatics",()=>d(()=>{let e=this.sheetTemplate.project.pointers.historic.sheetsById[this.address.sheetId];return v(e.staticOverrides.byObject[this.address.objectKey])||{}}))}getArrayOfValidSequenceTracks(){return this._cache.get("getArrayOfValidSequenceTracks",()=>d(()=>{let e=v(this.getDefaultValues()),r=this.project.pointers.historic.sheetsById[this.address.sheetId],o=v(r.sequence.tracksByObject[this.address.objectKey].trackIdByPropPath),n=[];if(o)for(let[a,i]of Object.entries(o)){let s;try{s=JSON.parse(a)}catch(p){Pe.warn(`property ${JSON.stringify(a)} cannot be parsed. Skipping.`);continue}typeof me(e,s)=="number"&&n.push({pathToProp:s,trackId:i})}else return Bt;return n.length===0?Bt:n}))}getMapOfValidSequenceTracks_forStudio(){return new T({})}getDefaultsAtPointer(e){let{path:r}=Ne(e),o=this.getDefaultValues().getValue();return Ft(o,r)}};var os=Re(Lo());var Uo=class extends Error{},w=class extends Uo{};var ns=/\s/;function as(t){for(var e=t.length;e--&&ns.test(t.charAt(e)););return e}var Ko=as;var is=/^\s+/;function ss(t){return t&&t.slice(0,Ko(t)+1).replace(is,"")}var Ho=ss;var Go=0/0,ps=/^[-+]0x[0-9a-f]+$/i,us=/^0b[01]+$/i,ls=/^0o[0-7]+$/i,fs=parseInt;function cs(t){if(typeof t=="number")return t;if(z(t))return Go;if(Y(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=Y(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=Ho(t);var r=us.test(t);return r||ls.test(t)?fs(t.slice(2),r?2:8):ps.test(t)?Go:+t}var Jo=cs;var Yo=1/0,ds=17976931348623157e292;function hs(t){if(!t)return t===0?t:0;if(t=Jo(t),t===Yo||t===-Yo){var e=t<0?-1:1;return e*ds}return t===t?t:0}var Xo=hs;function ms(t){var e=Xo(t),r=e%1;return e===e?r?e-r:e:0}var Zo=ms;function ys(t,e,r){var o=-1,n=t.length;e<0&&(e=-e>n?0:n+e),r=r>n?n:r,r<0&&(r+=n),n=e>r?0:r-e>>>0,e>>>=0;for(var a=Array(n);++o<n;)a[o]=t[o+e];return a}var Qo=ys;function gs(t,e,r){var o=t.length;return r=r===void 0?o:r,!e&&r>=o?t:Qo(t,e,r)}var en=gs;var vs="\\ud800-\\udfff",bs="\\u0300-\\u036f",js="\\ufe20-\\ufe2f",xs="\\u20d0-\\u20ff",Ps=bs+js+xs,_s="\\ufe0e\\ufe0f",Ss="\\u200d",Is=RegExp("["+Ss+vs+Ps+_s+"]");function Ts(t){return Is.test(t)}var Se=Ts;function ws(t){return t.split("")}var tn=ws;var rn="\\ud800-\\udfff",Ds="\\u0300-\\u036f",As="\\ufe20-\\ufe2f",Os="\\u20d0-\\u20ff",ks=Ds+As+Os,Cs="\\ufe0e\\ufe0f",Vs="["+rn+"]",Ut="["+ks+"]",Kt="\\ud83c[\\udffb-\\udfff]",Ns="(?:"+Ut+"|"+Kt+")",on="[^"+rn+"]",nn="(?:\\ud83c[\\udde6-\\uddff]){2}",an="[\\ud800-\\udbff][\\udc00-\\udfff]",Ms="\\u200d",sn=Ns+"?",pn="["+Cs+"]?",Es="(?:"+Ms+"(?:"+[on,nn,an].join("|")+")"+pn+sn+")*",$s=pn+sn+Es,Bs="(?:"+[on+Ut+"?",Ut,nn,an,Vs].join("|")+")",Fs=RegExp(Kt+"(?="+Kt+")|"+Bs+$s,"g");function Rs(t){return t.match(Fs)||[]}var un=Rs;function qs(t){return Se(t)?un(t):tn(t)}var ln=qs;function zs(t){return function(e){return e==null?void 0:e[t]}}var fn=zs;var Ws=9007199254740991,Ls=Math.floor;function Us(t,e){var r="";if(!t||e<1||e>Ws)return r;do e%2&&(r+=t),e=Ls(e/2),e&&(t+=t);while(e);return r}var Ht=Us;var Ks=fn("length"),cn=Ks;var dn="\\ud800-\\udfff",Hs="\\u0300-\\u036f",Gs="\\ufe20-\\ufe2f",Js="\\u20d0-\\u20ff",Ys=Hs+Gs+Js,Xs="\\ufe0e\\ufe0f",Zs="["+dn+"]",Gt="["+Ys+"]",Jt="\\ud83c[\\udffb-\\udfff]",Qs="(?:"+Gt+"|"+Jt+")",hn="[^"+dn+"]",mn="(?:\\ud83c[\\udde6-\\uddff]){2}",yn="[\\ud800-\\udbff][\\udc00-\\udfff]",ep="\\u200d",gn=Qs+"?",vn="["+Xs+"]?",tp="(?:"+ep+"(?:"+[hn,mn,yn].join("|")+")"+vn+gn+")*",rp=vn+gn+tp,op="(?:"+[hn+Gt+"?",Gt,mn,yn,Zs].join("|")+")",bn=RegExp(Jt+"(?="+Jt+")|"+op+rp,"g");function np(t){for(var e=bn.lastIndex=0;bn.test(t);)++e;return e}var jn=np;function ap(t){return Se(t)?jn(t):cn(t)}var at=ap;var ip=Math.ceil;function sp(t,e){e=e===void 0?" ":Le(e);var r=e.length;if(r<2)return r?Ht(e,t):e;var o=Ht(e,ip(t/at(e)));return Se(e)?en(ln(o),0,t).join(""):o.slice(0,t)}var xn=sp;function pp(t,e,r){t=Ue(t),e=Zo(e);var o=e?at(t):0;return e&&o<e?xn(e-o,r)+t:t}var re=pp;function B(){let t,e,r=new Promise((n,a)=>{t=i=>{n(i),o.status="resolved"},e=i=>{a(i),o.status="rejected"}}),o={resolve:t,reject:e,promise:r,status:"pending"};return o}var up=()=>{},Ie=up;var it=class{constructor(e){this._ticker=e;l(this,"playing",!1);l(this,"_stopPlayCallback",Ie);l(this,"_state",new y({position:0}));l(this,"statePointer");this.statePointer=this._state.pointer}destroy(){}pause(){this._stopPlayCallback(),this.playing=!1,this._stopPlayCallback=Ie}gotoPosition(e){this._updatePositionInState(e)}_updatePositionInState(e){this._state.reduceState(["position"],()=>e)}getCurrentPosition(){return this._state.getState().position}play(e,r,o,n){this.playing&&this.pause(),this.playing=!0;let a=this._ticker,i=r[1]-r[0];{let c=this.getCurrentPosition();c<r[0]||c>r[1]?n==="normal"||n==="alternate"?this._updatePositionInState(r[0]):(n==="reverse"||n==="alternateReverse")&&this._updatePositionInState(r[1]):n==="normal"||n==="alternate"?c===r[1]&&this._updatePositionInState(r[0]):c===r[0]&&this._updatePositionInState(r[1])}let s=B(),u=a.time,p=i*e,f=this.getCurrentPosition()-r[0];(n==="reverse"||n==="alternateReverse")&&(f=r[1]-this.getCurrentPosition());let h=c=>{let J=Math.max(c-u,0)/1e3,R=Math.min(J*o+f,p);if(R!==p){let k=Math.floor(R/i),A=R/i%1*i;if(n!=="normal")if(n==="reverse")A=i-A;else{let q=k%2==0;n==="alternate"?q||(A=i-A):q&&(A=i-A)}this._updatePositionInState(A+r[0]),b()}else{if(n==="normal")this._updatePositionInState(r[1]);else if(n==="reverse")this._updatePositionInState(r[0]);else{let k=(e-1)%2==0;n==="alternate"?k?this._updatePositionInState(r[1]):this._updatePositionInState(r[0]):k?this._updatePositionInState(r[0]):this._updatePositionInState(r[1])}this.playing=!1,s.resolve(!0)}};this._stopPlayCallback=()=>{a.offThisOrNextTick(h),a.offNextTick(h),this.playing&&s.resolve(!1)};let b=()=>a.onNextTick(h);return a.onThisOrNextTick(h),s.promise}};var st=class{constructor(e,r,o,n){this._ticker=e;this._decodedBuffer=r;this._audioContext=o;this._nodeDestination=n;l(this,"_mainGain");l(this,"_state",new y({position:0}));l(this,"statePointer");l(this,"_stopPlayCallback",Ie);l(this,"playing",!1);this.statePointer=this._state.pointer,this._mainGain=this._audioContext.createGain(),this._mainGain.connect(this._nodeDestination)}destroy(){}pause(){this._stopPlayCallback(),this.playing=!1,this._stopPlayCallback=Ie}gotoPosition(e){this._updatePositionInState(e)}_updatePositionInState(e){this._state.reduceState(["position"],()=>e)}getCurrentPosition(){return this._state.getState().position}play(e,r,o,n){this.playing&&this.pause(),this.playing=!0;let a=this._ticker,i=this.getCurrentPosition(),s=r[1]-r[0];if(n!=="normal")throw new w(`Audio-controlled sequences can only be played in the "normal" direction. '${n}' given.`);i<r[0]||i>r[1]?this._updatePositionInState(r[0]):i===r[1]&&this._updatePositionInState(r[0]),i=this.getCurrentPosition();let u=B(),p=this._audioContext.createBufferSource();p.buffer=this._decodedBuffer,p.connect(this._mainGain),p.playbackRate.value=o,e>1e3&&(console.warn("Audio-controlled sequences cannot have an iterationCount larger than 1000. It has been clamped to 1000."),e=1e3),e>1&&(p.loop=!0,p.loopStart=r[0],p.loopEnd=r[1]);let f=a.time,h=i-r[0],b=s*e;p.start(0,i,b-h);let c=R=>{let A=Math.max(R-f,0)/1e3,q=Math.min(A*o+h,b);if(q!==b){let qn=q/s%1*s;this._updatePositionInState(qn+r[0]),J()}else this._updatePositionInState(r[1]),this.playing=!1,Oe(),u.resolve(!0)},Oe=()=>{p.stop(),p.disconnect()};this._stopPlayCallback=()=>{Oe(),a.offThisOrNextTick(c),a.offNextTick(c),this.playing&&u.resolve(!1)};let J=()=>a.onNextTick(c);return a.onThisOrNextTick(c),u.promise}};var pt=class{get type(){return"Theatre_Sequence_PublicAPI"}constructor(e){H(this,e)}play(e){if(m(this)._project.isReady())return m(this).play(e);{let r=B();return r.resolve(!0),r.promise}}pause(){m(this).pause()}get position(){return m(this).position}set position(e){m(this).position=e}async attachAudio(e){let{audioContext:r,destinationNode:o,decodedBuffer:n}=await lp(e),a=new st($,n,r,o);return m(this).replacePlaybackController(a),{audioContext:r,destinationNode:o,decodedBuffer:n}}};async function lp(t){function e(){if(t.audioContext)return Promise.resolve(t.audioContext);let u=new AudioContext;return u.state==="running"?Promise.resolve(u):new Promise(p=>{let f=()=>{u.resume()},h=["mousedown","keydown","touchstart"],b={capture:!0,passive:!1};h.forEach(c=>{window.addEventListener(c,f,b)}),u.addEventListener("statechange",()=>{u.state==="running"&&(h.forEach(c=>{window.removeEventListener(c,f,b)}),p(u))})})}async function r(){if(t.source instanceof AudioBuffer)return t.source;let u=B();if(typeof t.source!="string")throw new Error("Error validating arguments to sequence.attachAudio(). args.source must either be a string or an instance of AudioBuffer.");let p;try{p=await fetch(t.source)}catch(c){throw console.error(c),new Error(`Could not fetch '${t.source}'. Network error logged above.`)}let f;try{f=await p.arrayBuffer()}catch(c){throw console.error(c),new Error(`Could not read '${t.source}' as an arrayBuffer.`)}(await o).decodeAudioData(f,u.resolve,u.reject);let b;try{b=await u.promise}catch(c){throw console.error(c),new Error(`Could not decode ${t.source} as an audio file.`)}return b}let o=e(),n=r(),[a,i]=await Promise.all([o,n]);return{destinationNode:t.destinationNode||a.destination,audioContext:a,decodedBuffer:i}}var ut=class{constructor(e,r,o,n,a){this._project=e;this._sheet=r;this._lengthD=o;this._subUnitsPerUnitD=n;l(this,"address");l(this,"publicApi");l(this,"_playbackControllerBox");l(this,"_statePointerDerivation");l(this,"_positionD");l(this,"_positionFormatterD");l(this,"_playableRangeD");l(this,"closestGridPosition",e=>{let r=this.subUnitsPerUnit,o=1/r;return parseFloat((Math.round(e/o)*o).toFixed(3))});this.address=x(g({},this._sheet.address),{sequenceName:"default"}),this.publicApi=new pt(this),this._playbackControllerBox=new E(a!=null?a:new it($)),this._statePointerDerivation=this._playbackControllerBox.derivation.map(i=>i.statePointer),this._positionD=this._statePointerDerivation.flatMap(i=>S(i.position)),this._positionFormatterD=this._subUnitsPerUnitD.map(i=>new Pn(i))}get positionFormatter(){return this._positionFormatterD.getValue()}get derivationToStatePointer(){return this._statePointerDerivation}get length(){return this._lengthD.getValue()}get positionDerivation(){return this._positionD}get position(){return this._playbackControllerBox.get().getCurrentPosition()}get subUnitsPerUnit(){return this._subUnitsPerUnitD.getValue()}get positionSnappedToGrid(){return this.closestGridPosition(this.position)}set position(e){let r=e;this.pause(),r>this.length&&(r=this.length);let o=this.length;this._playbackControllerBox.get().gotoPosition(r>o?o:r)}getDurationCold(){return this._lengthD.getValue()}get playing(){return this._playbackControllerBox.get().playing}_makeRangeFromSequenceTemplate(){return d(()=>[0,v(this._lengthD)])}async play(e){let r=this.length,o=e&&e.range?e.range:[0,r],n=e&&typeof e.iterationCount=="number"?e.iterationCount:1,a=e&&typeof e.rate!="undefined"?e.rate:1,i=e&&e.direction?e.direction:"normal";return await this._play(n,[o[0],o[1]],a,i)}_play(e,r,o,n){return this._playbackControllerBox.get().play(e,r,o,n)}pause(){this._playbackControllerBox.get().pause()}replacePlaybackController(e){this.pause();let r=this._playbackControllerBox.get();this._playbackControllerBox.set(e);let o=r.getCurrentPosition();r.destroy(),e.gotoPosition(o)}},Pn=class{constructor(e){this._fps=e}formatSubUnitForGrid(e){let r=e%1,o=1/this._fps;return Math.round(r/o)+"f"}formatFullUnitForGrid(e){let r=e,o="";r>=Te&&(o+=Math.floor(r/Te)+"h",r=r%Te),r>=ne&&(o+=Math.floor(r/ne)+"m",r=r%ne),r>=oe&&(o+=Math.floor(r/oe)+"s",r=r%oe);let n=1/this._fps;return r>=n&&(o+=Math.floor(r/n)+"f",r=r%n),o.length===0?"0s":o}formatForPlayhead(e){let r=e,o="";if(r>=Te){let a=Math.floor(r/Te);o+=re(a.toString(),2,"0")+"h",r=r%Te}if(r>=ne){let a=Math.floor(r/ne);o+=re(a.toString(),2,"0")+"m",r=r%ne}else o.length>0&&(o+="00m");if(r>=oe){let a=Math.floor(r/oe);o+=re(a.toString(),2,"0")+"s",r=r%oe}else o+="00s";let n=1/this._fps;if(r>=n){let a=Math.round(r/n);o+=re(a.toString(),2,"0")+"f",r=r%n}else r/n>.98?(o+=re(1 .toString(),2,"0")+"f",r=r%n):o+="00f";return o.length===0?"00s00f":o}formatBasic(e){return e.toFixed(2)+"s"}},oe=1,ne=oe*60,Te=ne*60;var ft={};wt(ft,{boolean:()=>Xt,compound:()=>Me,number:()=>Yt,string:()=>Zt,stringLiteral:()=>hp});function lt(t,e){return t.length<=e?t:t.substr(0,e-3)+"..."}var fp=t=>typeof t=="string"?`string("${lt(t,10)}")`:typeof t=="number"?`number(${lt(String(t),10)})`:t===null?"null":t===void 0?"undefined":typeof t=="boolean"?String(t):Array.isArray(t)?"array":typeof t=="object"?"object":"unknown",we=fp;var ae=Symbol("TheatrePropType_Basic");function _n(t){return typeof t=="object"&&!!t&&t[ae]==="TheatrePropType"}function cp(t){if(typeof t=="number")return Yt(t);if(typeof t=="boolean")return Xt(t);if(typeof t=="string")return Zt(t);if(typeof t=="object"&&!!t){if(_n(t))return t;if(Ve(t))return Me(t);throw new w(`This value is not a valid prop type: ${we(t)}`)}else throw new w(`This value is not a valid prop type: ${we(t)}`)}function Sn(t){let e={};for(let r of Object.keys(t)){let o=t[r];_n(o)?e[r]=o:e[r]=cp(o)}return e}var dp=(t,e)=>{},Me=(t,e)=>(dp("t.compound(props, opts)",e),{type:"compound",props:Sn(t),valueType:null,[ae]:"TheatrePropType",label:e==null?void 0:e.label}),Yt=(t,e)=>{var r;return x(g({type:"number",valueType:0,default:t,[ae]:"TheatrePropType"},e||{}),{label:e==null?void 0:e.label,nudgeFn:(r=e==null?void 0:e.nudgeFn)!=null?r:mp,nudgeMultiplier:typeof(e==null?void 0:e.nudgeMultiplier)=="number"?e.nudgeMultiplier:1})},Xt=(t,e)=>({type:"boolean",default:t,valueType:null,[ae]:"TheatrePropType",label:e==null?void 0:e.label}),Zt=(t,e)=>({type:"string",default:t,valueType:null,[ae]:"TheatrePropType",label:e==null?void 0:e.label});function hp(t,e,r){var o;return{type:"stringLiteral",default:t,options:g({},e),[ae]:"TheatrePropType",valueType:null,as:(o=r==null?void 0:r.as)!=null?o:"menu",label:r==null?void 0:r.label}}var mp=({config:t,deltaX:e,deltaFraction:r,magnitude:o})=>{let{range:n}=t;return n?r*(n[1]-n[0])*o*t.nudgeMultiplier:e*o*t.nudgeMultiplier};var yp=t=>t.replace(/^[\s\/]*/,"").replace(/[\s\/]*$/,"").replace(/\s*\/\s*/," / "),gp=t=>{if(typeof t!="string")return`it is not a string. (it is a ${typeof t})`;let e=t.split(/\//);if(e.length===0)return"it is empty.";for(let r=0;r<e.length;r++){let o=e[r].trim();if(o.length===0)return`the component #${r+1} is empty.`;if(o.length>32)return`the component '${o}' must have 32 characters or less.`}};function ct(t,e){let r=yp(t);return r}var am=Re(Qt()),sm=new WeakMap,dt=class{get type(){return"Theatre_Sheet_PublicAPI"}constructor(e){H(this,e)}object(e,r){let o=m(this),n=ct(e,`sheet.object("${e}", ...)`),a=o.getObject(n),i=null;if(a)return a.publicApi;{let s=Me(r);return o.createObject(n,i,s).publicApi}}get sequence(){return m(this).getSequence().publicApi}get project(){return m(this).project.publicApi}get address(){return g({},m(this).address)}};var ht=class{constructor(e,r){this.template=e;this.instanceId=r;l(this,"_objects",new y({}));l(this,"_sequence");l(this,"address");l(this,"publicApi");l(this,"project");l(this,"objectsP",this._objects.pointer);l(this,"type","Theatre_Sheet");this.project=e.project,this.address=x(g({},e.address),{sheetInstanceId:this.instanceId}),this.publicApi=new dt(this)}createObject(e,r,o){let a=this.template.getObjectTemplate(e,r,o).createInstance(this,r,o);return this._objects.setIn([e],a),a}getObject(e){return this._objects.getState()[e]}getSequence(){if(!this._sequence){let e=S(this.project.pointers.historic.sheetsById[this.address.sheetId].sequence.length).map(o=>typeof o=="number"?o:10),r=S(this.project.pointers.historic.sheetsById[this.address.sheetId].sequence.subUnitsPerUnit).map(o=>typeof o=="number"?o:30);this._sequence=new ut(this.template.project,this,e,r)}return this._sequence}};var mt=class{constructor(e,r){this.project=e;l(this,"type","Theatre_SheetTemplate");l(this,"address");l(this,"_instances",new y({}));l(this,"instancesP",this._instances.pointer);l(this,"_objectTemplates",new y({}));l(this,"objectTemplatesP",this._objectTemplates.pointer);this.address=x(g({},e.address),{sheetId:r})}getInstance(e){let r=this._instances.getState()[e];return r||(r=new ht(this,e),this._instances.setIn([e],r)),r}getObjectTemplate(e,r,o){let n=this._objectTemplates.getState()[e];return n||(n=new ot(this,e,r,o),this._objectTemplates.setIn([e],n)),n}};var vp=t=>new Promise(e=>setTimeout(e,t)),Tn=vp;function D(t){for(var e=arguments.length,r=Array(e>1?e-1:0),o=1;o<e;o++)r[o-1]=arguments[o];if(!1)var n,a;throw Error("[Immer] minified error nr: "+t+(r.length?" "+r.map(function(i){return"'"+i+"'"}).join(","):"")+". Find the full error at: https://bit.ly/3cXEKWf")}function ie(t){return!!t&&!!t[P]}function se(t){return!!t&&(function(e){if(!e||typeof e!="object")return!1;var r=Object.getPrototypeOf(e);if(r===null)return!0;var o=Object.hasOwnProperty.call(r,"constructor")&&r.constructor;return o===Object||typeof o=="function"&&Function.toString.call(o)===Tp}(t)||Array.isArray(t)||!!t[$n]||!!t.constructor[$n]||tr(t)||rr(t))}function wn(t){return ie(t)||D(23,t),t[P].t}function Ee(t,e,r){r===void 0&&(r=!1),De(t)===0?(r?Object.keys:hr)(t).forEach(function(o){r&&typeof o=="symbol"||e(o,t[o],t)}):t.forEach(function(o,n){return e(n,o,t)})}function De(t){var e=t[P];return e?e.i>3?e.i-4:e.i:Array.isArray(t)?1:tr(t)?2:rr(t)?3:0}function er(t,e){return De(t)===2?t.has(e):Object.prototype.hasOwnProperty.call(t,e)}function bp(t,e){return De(t)===2?t.get(e):t[e]}function Dn(t,e,r){var o=De(t);o===2?t.set(e,r):o===3?(t.delete(e),t.add(r)):t[e]=r}function jp(t,e){return t===e?t!==0||1/t==1/e:t!=t&&e!=e}function tr(t){return Sp&&t instanceof Map}function rr(t){return Ip&&t instanceof Set}function pe(t){return t.o||t.t}function or(t){if(Array.isArray(t))return Array.prototype.slice.call(t);var e=wp(t);delete e[P];for(var r=hr(e),o=0;o<r.length;o++){var n=r[o],a=e[n];a.writable===!1&&(a.writable=!0,a.configurable=!0),(a.get||a.set)&&(e[n]={configurable:!0,writable:!0,enumerable:a.enumerable,value:t[n]})}return Object.create(Object.getPrototypeOf(t),e)}function nr(t,e){return e===void 0&&(e=!1),ar(t)||ie(t)||!se(t)||(De(t)>1&&(t.set=t.add=t.clear=t.delete=xp),Object.freeze(t),e&&Ee(t,function(r,o){return nr(o,!0)},!0)),t}function xp(){D(2)}function ar(t){return t==null||typeof t!="object"||Object.isFrozen(t)}function F(t){var e=Dp[t];return e||D(18,t),e}function An(){return $e}function ir(t,e){e&&(F("Patches"),t.u=[],t.s=[],t.v=e)}function yt(t){sr(t),t.p.forEach(Pp),t.p=null}function sr(t){t===$e&&($e=t.l)}function On(t){return $e={p:[],l:$e,h:t,m:!0,_:0}}function Pp(t){var e=t[P];e.i===0||e.i===1?e.j():e.O=!0}function pr(t,e){e._=e.p.length;var r=e.p[0],o=t!==void 0&&t!==r;return e.h.g||F("ES5").S(e,t,o),o?(r[P].P&&(yt(e),D(4)),se(t)&&(t=gt(e,t),e.l||vt(e,t)),e.u&&F("Patches").M(r[P],t,e.u,e.s)):t=gt(e,r,[]),yt(e),e.u&&e.v(e.u,e.s),t!==En?t:void 0}function gt(t,e,r){if(ar(e))return e;var o=e[P];if(!o)return Ee(e,function(a,i){return kn(t,o,e,a,i,r)},!0),e;if(o.A!==t)return e;if(!o.P)return vt(t,o.t,!0),o.t;if(!o.I){o.I=!0,o.A._--;var n=o.i===4||o.i===5?o.o=or(o.k):o.o;Ee(o.i===3?new Set(n):n,function(a,i){return kn(t,o,n,a,i,r)}),vt(t,n,!1),r&&t.u&&F("Patches").R(o,r,t.u,t.s)}return o.o}function kn(t,e,r,o,n,a){if(ie(n)){var i=gt(t,n,a&&e&&e.i!==3&&!er(e.D,o)?a.concat(o):void 0);if(Dn(r,o,i),!ie(i))return;t.m=!1}if(se(n)&&!ar(n)){if(!t.h.F&&t._<1)return;gt(t,n),e&&e.A.l||vt(t,n)}}function vt(t,e,r){r===void 0&&(r=!1),t.h.F&&t.m&&nr(e,r)}function ur(t,e){var r=t[P];return(r?pe(r):t)[e]}function Cn(t,e){if(e in t)for(var r=Object.getPrototypeOf(t);r;){var o=Object.getOwnPropertyDescriptor(r,e);if(o)return o;r=Object.getPrototypeOf(r)}}function lr(t){t.P||(t.P=!0,t.l&&lr(t.l))}function fr(t){t.o||(t.o=or(t.t))}function cr(t,e,r){var o=tr(e)?F("MapSet").N(e,r):rr(e)?F("MapSet").T(e,r):t.g?function(n,a){var i=Array.isArray(n),s={i:i?1:0,A:a?a.A:An(),P:!1,I:!1,D:{},l:a,t:n,k:null,o:null,j:null,C:!1},u=s,p=bt;i&&(u=[s],p=jt);var f=Proxy.revocable(u,p),h=f.revoke,b=f.proxy;return s.k=b,s.j=h,b}(e,r):F("ES5").J(e,r);return(r?r.A:An()).p.push(o),o}function _p(t){return ie(t)||D(22,t),function e(r){if(!se(r))return r;var o,n=r[P],a=De(r);if(n){if(!n.P&&(n.i<4||!F("ES5").K(n)))return n.t;n.I=!0,o=Vn(r,a),n.I=!1}else o=Vn(r,a);return Ee(o,function(i,s){n&&bp(n.t,i)===s||Dn(o,i,e(s))}),a===3?new Set(o):o}(t)}function Vn(t,e){switch(e){case 2:return new Map(t);case 3:return Array.from(t)}return or(t)}var Nn,$e,dr=typeof Symbol!="undefined"&&typeof Symbol("x")=="symbol",Sp=typeof Map!="undefined",Ip=typeof Set!="undefined",Mn=typeof Proxy!="undefined"&&Proxy.revocable!==void 0&&typeof Reflect!="undefined",En=dr?Symbol.for("immer-nothing"):((Nn={})["immer-nothing"]=!0,Nn),$n=dr?Symbol.for("immer-draftable"):"__$immer_draftable",P=dr?Symbol.for("immer-state"):"__$immer_state",vm=typeof Symbol!="undefined"&&Symbol.iterator||"@@iterator";var Tp=""+Object.prototype.constructor,hr=typeof Reflect!="undefined"&&Reflect.ownKeys?Reflect.ownKeys:Object.getOwnPropertySymbols!==void 0?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:Object.getOwnPropertyNames,wp=Object.getOwnPropertyDescriptors||function(t){var e={};return hr(t).forEach(function(r){e[r]=Object.getOwnPropertyDescriptor(t,r)}),e},Dp={},bt={get:function(t,e){if(e===P)return t;var r=pe(t);if(!er(r,e))return function(n,a,i){var s,u=Cn(a,i);return u?"value"in u?u.value:(s=u.get)===null||s===void 0?void 0:s.call(n.k):void 0}(t,r,e);var o=r[e];return t.I||!se(o)?o:o===ur(t.t,e)?(fr(t),t.o[e]=cr(t.A.h,o,t)):o},has:function(t,e){return e in pe(t)},ownKeys:function(t){return Reflect.ownKeys(pe(t))},set:function(t,e,r){var o=Cn(pe(t),e);if(o==null?void 0:o.set)return o.set.call(t.k,r),!0;if(!t.P){var n=ur(pe(t),e),a=n==null?void 0:n[P];if(a&&a.t===r)return t.o[e]=r,t.D[e]=!1,!0;if(jp(r,n)&&(r!==void 0||er(t.t,e)))return!0;fr(t),lr(t)}return t.o[e]===r&&typeof r!="number"&&(r!==void 0||e in t.o)||(t.o[e]=r,t.D[e]=!0,!0)},deleteProperty:function(t,e){return ur(t.t,e)!==void 0||e in t.t?(t.D[e]=!1,fr(t),lr(t)):delete t.D[e],t.o&&delete t.o[e],!0},getOwnPropertyDescriptor:function(t,e){var r=pe(t),o=Reflect.getOwnPropertyDescriptor(r,e);return o&&{writable:!0,configurable:t.i!==1||e!=="length",enumerable:o.enumerable,value:r[e]}},defineProperty:function(){D(11)},getPrototypeOf:function(t){return Object.getPrototypeOf(t.t)},setPrototypeOf:function(){D(12)}},jt={};Ee(bt,function(t,e){jt[t]=function(){return arguments[0]=arguments[0][0],e.apply(this,arguments)}}),jt.deleteProperty=function(t,e){return bt.deleteProperty.call(this,t[0],e)},jt.set=function(t,e,r){return bt.set.call(this,t[0],e,r,t[0])};var Ap=function(){function t(r){var o=this;this.g=Mn,this.F=!0,this.produce=function(n,a,i){if(typeof n=="function"&&typeof a!="function"){var s=a;a=n;var u=o;return function(c){var Oe=this;c===void 0&&(c=s);for(var J=arguments.length,R=Array(J>1?J-1:0),k=1;k<J;k++)R[k-1]=arguments[k];return u.produce(c,function(A){var q;return(q=a).call.apply(q,[Oe,A].concat(R))})}}var p;if(typeof a!="function"&&D(6),i!==void 0&&typeof i!="function"&&D(7),se(n)){var f=On(o),h=cr(o,n,void 0),b=!0;try{p=a(h),b=!1}finally{b?yt(f):sr(f)}return typeof Promise!="undefined"&&p instanceof Promise?p.then(function(c){return ir(f,i),pr(c,f)},function(c){throw yt(f),c}):(ir(f,i),pr(p,f))}if(!n||typeof n!="object")return(p=a(n))===En?void 0:(p===void 0&&(p=n),o.F&&nr(p,!0),p);D(21,n)},this.produceWithPatches=function(n,a){return typeof n=="function"?function(u){for(var p=arguments.length,f=Array(p>1?p-1:0),h=1;h<p;h++)f[h-1]=arguments[h];return o.produceWithPatches(u,function(b){return n.apply(void 0,[b].concat(f))})}:[o.produce(n,a,function(u,p){i=u,s=p}),i,s];var i,s},typeof(r==null?void 0:r.useProxies)=="boolean"&&this.setUseProxies(r.useProxies),typeof(r==null?void 0:r.autoFreeze)=="boolean"&&this.setAutoFreeze(r.autoFreeze)}var e=t.prototype;return e.createDraft=function(r){se(r)||D(8),ie(r)&&(r=_p(r));var o=On(this),n=cr(this,r,void 0);return n[P].C=!0,sr(o),n},e.finishDraft=function(r,o){var n=r&&r[P],a=n.A;return ir(a,o),pr(void 0,a)},e.setAutoFreeze=function(r){this.F=r},e.setUseProxies=function(r){r&&!Mn&&D(20),this.g=r},e.applyPatches=function(r,o){var n;for(n=o.length-1;n>=0;n--){var a=o[n];if(a.path.length===0&&a.op==="replace"){r=a.value;break}}var i=F("Patches").$;return ie(r)?i(r,o):this.produce(r,function(s){return i(s,o.slice(n+1))})},t}(),I=new Ap,bm=I.produce,jm=I.produceWithPatches.bind(I),xm=I.setAutoFreeze.bind(I),Pm=I.setUseProxies.bind(I),_m=I.applyPatches.bind(I),Sm=I.createDraft.bind(I),Im=I.finishDraft.bind(I);var Op={currentProjectStateDefinitionVersion:"0.4.0"},Ae=Op;async function mr(t,e,r){await Tn(0),t.transaction(({drafts:o})=>{var f;let n=e.address.projectId;o.ephemeral.coreByProject[n]={lastExportedObject:null,loadingState:{type:"loading"}},o.ahistoric.coreByProject[n]={ahistoricStuff:""};function a(){o.ephemeral.coreByProject[n].loadingState={type:"loaded"},o.historic.coreByProject[n]={sheetsById:{},definitionVersion:Ae.currentProjectStateDefinitionVersion,revisionHistory:[]}}function i(h){o.ephemeral.coreByProject[n].loadingState={type:"loaded"},o.historic.coreByProject[n]=h}function s(){o.ephemeral.coreByProject[n].loadingState={type:"loaded"}}function u(h){o.ephemeral.coreByProject[n].loadingState={type:"browserStateIsNotBasedOnDiskState",onDiskState:h}}let p=(f=wn(o.historic))==null?void 0:f.coreByProject[e.address.projectId];p?r&&p.revisionHistory.indexOf(r.revisionHistory[0])==-1?u(r):s():r?i(r):a()})}var xt=class{constructor(e,r={},o){this.config=r;this.publicApi=o;l(this,"pointers");l(this,"_pointerProxies");l(this,"address");l(this,"_readyDeferred");l(this,"_sheetTemplates",new y({}));l(this,"sheetTemplatesP",this._sheetTemplates.pointer);l(this,"_studio");l(this,"type","Theatre_Project");var a;this.address={projectId:e};let n=new y({ahistoric:{ahistoricStuff:""},historic:(a=r.state)!=null?a:{sheetsById:{},definitionVersion:Ae.currentProjectStateDefinitionVersion,revisionHistory:[]},ephemeral:{loadingState:{type:"loaded"},lastExportedObject:null}});this._pointerProxies={historic:new ee(n.pointer.historic),ahistoric:new ee(n.pointer.ahistoric),ephemeral:new ee(n.pointer.ephemeral)},this.pointers={historic:this._pointerProxies.historic.pointer,ahistoric:this._pointerProxies.ahistoric.pointer,ephemeral:this._pointerProxies.ephemeral.pointer},xe.add(e,this),this._readyDeferred=B(),r.state?setTimeout(()=>{this._studio||this._readyDeferred.resolve(void 0)},0):setTimeout(()=>{if(!this._studio)throw new Error(`Argument config.state in Theatre.getProject("${e}", config) is empty. This is fine while you are using @theatre/core along with @theatre/sutdio. But since @theatre/studio is not loaded, the state of project "${e}" will be empty.

To fix this, you need to add @theatre/studio into the bundle and export the projet's state. Learn how to do that at https://docs.theatrejs.com/in-depth/#exporting`)},1e3)}attachToStudio(e){if(this._studio){if(this._studio!==e)throw new Error(`Project ${this.address.projectId} is already attached to studio ${this._studio.address.studioId}`);console.warn(`Project ${this.address.projectId} is already attached to studio ${this._studio.address.studioId}`);return}this._studio=e,e.initialized.then(async()=>{await mr(e,this,this.config.state),this._pointerProxies.historic.setPointer(e.atomP.historic.coreByProject[this.address.projectId]),this._pointerProxies.ahistoric.setPointer(e.atomP.ahistoric.coreByProject[this.address.projectId]),this._pointerProxies.ephemeral.setPointer(e.atomP.ephemeral.coreByProject[this.address.projectId]),this._readyDeferred.resolve(void 0)})}get isAttachedToStudio(){return!!this._studio}get ready(){return this._readyDeferred.promise}isReady(){return this._readyDeferred.status==="resolved"}getOrCreateSheet(e,r="default"){let o=this._sheetTemplates.getState()[e];return o||(o=new mt(this,e),this._sheetTemplates.setIn([e],o)),o.getInstance(r)}};var Pt=class{get type(){return"Theatre_Project_PublicAPI"}constructor(e,r={}){H(this,new xt(e,r,this))}get ready(){return m(this).ready}get isReady(){return m(this).isReady()}get address(){return g({},m(this).address)}sheet(e,r="default"){let o=ct(e,"project.sheet");return m(this).getOrCreateSheet(o,r).publicApi}};var ry=Re(Qt());function Bn(t,e={}){let r=jr(e,[]),o=xe.get(t);return o?o.publicApi:(e.state&&Cp(t,e.state),new Pt(t,r))}var kp=(t,e)=>{if(Array.isArray(e)||e==null||e.definitionVersion!==Ae.currentProjectStateDefinitionVersion)throw new w(`Error validating conf.state in Theatre.getProject(${JSON.stringify(t)}, conf). The state seems to be formatted in a way that is unreadable to Theatre.js. Read more at https://docs.theatrejs.com`)},Cp=(t,e)=>{kp(t,e)};function Fn(t,e){if(Q(t))return S(t).tapImmediate($,e);if(C(t))return t.tapImmediate($,e);throw new Error("Called onChange(p) where p is neither a pointer nor a derivation.")}var Rn="__TheatreJS_StudioBundle",_t="__TheatreJS_CoreBundle";var St=class{constructor(){l(this,"_studio")}get type(){return"Theatre_CoreBundle"}get version(){return process.env.version}getBitsForStudio(e,r){if(this._studio)throw new Error("@theatre/core is already attached to @theatre/studio");this._studio=e;let o={projectsP:xe.atom.pointer.projects,privateAPI:m,coreExports:yr};r(o)}};Vp();function Vp(){if(typeof window=="undefined")return;let t=window[_t];if(typeof t!="undefined")throw typeof t=="object"&&t&&typeof t.version=="string"?new Error(`It seems that the module '@theatre/core' is loaded more than once. This could have two possible causes:
1. You might have two separate versions of theatre in node_modules.
2. Or this might be a bundling misconfiguration, in case you're using a bundler like Webpack/ESBuild/Rollup.

Note that it **is okay** to import '@theatre/core' multiple times. But those imports should point to the same module.`):new Error(`The variable window.${_t} seems to be already set by a module other than @theatre/core.`);let e=new St;window[_t]=e;let r=window[Rn];r&&r!==null&&r.type==="Theatre_StudioBundle"&&r.registerCoreBundle(e)}window.Theatre={core:gr,get studio(){alert("Theatre.studio is only available in the core-and-studio.js bundle. You're using the core-only.min.js bundle.")}};})();
/**
 * @license
 * Lodash (Custom Build) <https://lodash.com/>
 * Build: `lodash modularize exports="es" -o ./`
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */